import React,{Component} from 'react';import {    Dimensions,    View,    Text,    StyleSheet,    ScrollView,    TouchableOpacity,    Image,    DeviceEventEmitter,    Alert,    TextInput} from 'react-native'import {connect} from 'react-redux'var ImagePicker = require('react-native-image-picker');import {Toolbar,OPTION_SHOW,OPTION_NEVER,ACTION_ADD} from 'react-native-toolbar-wrapper';import Config from '../../../config';import Proxy from '../../utils/Proxy';import Video from 'react-native-video'import Icon from 'react-native-vector-icons/FontAwesome';import {getAccessToken} from "../../action/UserActions";import {saveOrUpdateBadmintonCourseClassRecords} from "../../action/CourseActions";var {height,width} = Dimensions.get('window');var IMGS = [    require('../../../img/zhibo1.jpeg'),    require('../../../img/zhibo2.jpeg'),    require('../../../img/zhibo3.jpeg'),];class AddVideo extends Component{    constructor(props){        super(props);        this.state={            isRefreshing:false,            video:{name:null,brief:null,longbrief:null,videourl:null,videopath:null,            authorId:this.props.personInfo.personId,type:1},        };    }    goBack(){        const { navigator } = this.props;        if(navigator) {            navigator.pop();        }    }    showImagePicker(){        var options = {            storageOptions: {                skipBackup: true,                path: 'images'            },            title:'请选择',            takePhotoButtonTitle:'拍照',            chooseFromLibraryButtonTitle:'图库',            cancelButtonTitle:'取消',            mediaType:'video'        };        ImagePicker.showImagePicker(options, (response) => {            if (response.didCancel) {                console.log('User cancelled image picker');            }            else if (response.error) {                console.log('ImagePicker Error: ', response.error);            }            else if (response.customButton) {                console.log('User tapped custom button: ', response.customButton);            }            else {                let uri = { uri: response.uri };                let path = { uri: response.path };                this.setState({course:Object.assign(this.state.video,{videourl:uri,videopath:path})});                console.log('portrait.uri = ', response.uri);            }        });    }    render(){        return(            <View style={styles.container}>                <Toolbar width={width} title="添加视频" navigator={this.props.navigator} actions={[{icon:ACTION_ADD,show:OPTION_SHOW}]}>                    <View style={{flex:2,flexDirection:'column',height:60,justifyContent:'center',alignItems:'center',width:width}}>                        {/*视频名称*/}                        <View style={{flex:2,height:40,flexDirection:'row',justifyContent:'flex-end',alignItems: 'center',backgroundColor:'#fff',marginBottom:1}}>                            <View style={{flex:1}}>                                <Text style={{color:'#343434'}}>视频名称</Text>                            </View>                            <View style={{flex:3,flexDirection:'row',justifyContent:'flex-end',alignItems: 'center',backgroundColor:'#fff',                                borderRadius:10}}>                                <TextInput                                    placeholderTextColor='#888'                                    style={{fontSize:14,color:'#222',justifyContent:'flex-end',textAlign:'right',height:40,flex:3,padding:0}}                                    placeholder="请输入视频名称"                                    value={this.state.video.name}                                    underlineColorAndroid={'transparent'}                                    onChangeText={                                        (value)=>{                                            this.setState({course:Object.assign(this.state.video,{name:value})})                                        }}                                />                            </View>                        </View>                        {/*视频简介*/}                        <View style={{flex:2,flexDirection:'row',justifyContent:'flex-end',alignItems: 'center',backgroundColor:'#fff',marginBottom:1}}>                            <View style={{flex:1}}>                                <Text style={{color:'#343434'}}>视频简介</Text>                            </View>                            <View style={{flex:3,flexDirection:'row',justifyContent:'flex-end',alignItems: 'center',backgroundColor:'#fff',                                borderRadius:10}}>                                <TextInput                                    placeholderTextColor='#888'                                    style={{fontSize:14,color:'#222',justifyContent:'flex-end',textAlign:'right',height:40,flex:3,padding:0}}                                    placeholder="请输入视频简介"                                    value={this.state.video.brief}                                    underlineColorAndroid={'transparent'}                                    onChangeText={                                        (value)=>{                                            this.setState({course:Object.assign(this.state.video,{brief:value})})                                        }}                                />                            </View>                        </View>                        {/*描述*/}                        <View style={{height:120,width:width,flexDirection:'column',justifyContent:'flex-start',alignItems: 'center',backgroundColor:'#fff',marginBottom:1}}>                            <View style={{height:40,width:width,justifyContent:'center',textAlign:'left'}}>                                <Text style={{color:'#343434'}}>视频描述</Text>                            </View>                            <TextInput                                style={{height:80,width:width,fontSize:14,marginTop:5,borderRadius:5,backgroundColor:'#fff',padding:0}}                                onChangeText={(text) =>                                {                                    this.setState({course:Object.assign(this.state.video,{longbrief:text})});                                }}                                value={this.state.video.longbrief}                                placeholder='请描述视频内容'                                placeholderTextColor="#888"                                underlineColorAndroid={'transparent'}                                multiline={true}                            />                        </View>                    </View>                    {/*添加视频*/}                    <View style={{flex:2,flexDirection:'column',marginTop:20,borderWidth:2,borderColor:'#00BCD4',                            borderTopLeftRadius:4,borderTopRightRadius:4}}>                        <View style={{flexDirection:'row',padding:10,alignItems:'center',                                backgroundColor:'#00BCD4'}}>                            <View style={{flexDirection:'row',alignItems:'center',justifyContent:'center'}}>                                    <Text style={{color:'#fff',fontWeight:'bold',fontSize:16}}>添加视频</Text>                                </View>                                <View style={{flex:1}}></View>                                <TouchableOpacity style={{flexDirection:'row',alignItems:'center',justifyContent:'center',backgroundColor:'#66CDAA',                                    padding:6,paddingHorizontal:8,borderRadius:13,marginRight:5}}                                                  onPress={()=>{                                                      this.showImagePicker();                                                  }}                                >                                    <Icon name={'plus'} size={15} color="#fff"/>                                </TouchableOpacity>                            </View>                            <View style={{flex:1,flexDirection:'row',padding:4,paddingHorizontal:10,marginTop:4}}>                                {                                    this.state.video.videourl !== null?                                    <Video                                        source={{uri: this.state.video.videourl.uri}} // Can be a URL or a local file.                                        rate={1.0}                   // 控制暂停/播放，0 代表暂停                                        volume={1.0}                 // 声音的放大倍数，0 代表没有声音，就是静音muted, 1 代表正常音量 normal，更大的数字表示放大的倍数                                        muted={false}                //true代表静音，默认为false.                                        paused={false}               // Pauses playback entirely.                                        resizeMode="cover"           // 视频的自适应伸缩铺放行为，                                        repeat={true}                // 是否重复播放                                        style={styles.backgroundVideo}                                    />:null                                }                                {/*{*/}                                    {/*this.state.video.videourl?*/}                                        {/*<View>*/}                                    {/*<Text>添加路径：</Text>*/}                                    {/*<Text>{this.state.video.videourl.uri}</Text>*/}                                    {/*<Text>{this.state.video.videopath.uri}</Text>*/}                                        {/*</View>:null*/}                                {/*}*/}                            </View>                    </View>                    <View style={{flex:1,flexDirection:'row',height:60,justifyContent:'center',alignItems:'center',width:width}}>                        <TouchableOpacity style={{flex:1,width:width*2/3,backgroundColor:'#66CDAA',borderRadius:10,padding:10,flexDirection:'row',                            justifyContent:'center'}}                                          onPress={()=>{                                              Proxy.postes({                                                  url: Config.server + '/func/allow/addVideoInformation',                                                  headers: {                                                      'Content-Type': 'application/json',                                                  },                                                  body: {                                                      video:this.state.video                                                  }                                              }).then((json) => {                                                  var videoId = json.data;                                                  var formData = new FormData();                                                  var file = {uri: this.state.video.videourl.uri, type: 'multipart/form-data', name: 'video.mp4'};                                                  formData.append('video',file)                                                  Proxy.post({                                                      url:Config.server+'/func/allow/uploadVideos?videoId='+videoId.toString(),                                                      headers: {                                                          'Content-Type':'multipart/form-data',                                                      },                                                      body: formData,                                                  }).then((json)=> {                                                      var data = json.data;                                                      if(data == 'success'){                                                          alert("添加视频成功！")                                                          this.goBack();                                                      }                                                      resolve(json)                                                  }).catch((err) =>{                                                      //reject(err)                                                  })                                              }).catch((err) => {                                                  alert(err);                                              });                                          }}>                            <Text style={{color:'#fff',fontSize:15}}>确定添加</Text>                        </TouchableOpacity>                    </View>                </Toolbar>            </View>        )    }}const styles = StyleSheet.create({    container:{        flex:1,backgroundColor:'#eee'    },    backgroundVideo: {        position: 'absolute',        top: 0,        left: 0,        bottom: 0,        right: 0,    },})module.exports = connect(state=>({        accessToken:state.user.accessToken,        personInfo:state.user.personInfo,    }))(AddVideo);